<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>KMCLU Library Portal | Academic Book Search</title>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

<!-- Stable XLSX (no buggy writeFile) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:Arial,Helvetica,sans-serif;
background:#0f172a;
color:#e5e7eb;
display:flex;
flex-direction:column;
min-height:100vh;
}
header{
display:flex;
justify-content:space-between;
align-items:center;
padding:16px 20px;
background:#020617;
}
.home-btn{color:#38bdf8;text-decoration:none;font-size:14px}
main{
flex:1;
display:flex;
justify-content:center;
align-items:center;
padding:40px 20px;
}
.container{
background:#020617;
width:95%;
max-width:700px;
padding:40px 30px;
border-radius:24px;
box-shadow:0 25px 50px rgba(0,0,0,.4);
text-align:center;
}
.search-wrapper{position:relative;margin-bottom:25px}
.search-wrapper input{
width:100%;height:56px;border-radius:30px;
border:2px solid #38bdf8;padding:0 60px 0 22px;
background:#0f172a;color:#fff;font-size:16px;
}
.search-icon-btn{
position:absolute;right:8px;top:50%;
transform:translateY(-50%);
width:46px;height:46px;border-radius:50%;
background:#38bdf8;display:flex;
justify-content:center;align-items:center;
cursor:pointer;
}
.button-row{display:flex;gap:14px;margin-bottom:15px}
.button-row button{
flex:1;padding:13px;border-radius:14px;
border:none;font-weight:600;
background:#38bdf8;color:#020617;cursor:pointer;
}
.notification{display:none;padding:10px;border-radius:10px;margin-bottom:15px}
.success{background:#38bdf8;color:#020617}
.error{background:#b23a48;color:white}
.book-card{
background:#0f172a;border-radius:14px;
padding:14px;margin-bottom:12px;
border:2px solid #1e3a5f;text-align:left;
}
footer{
text-align:center;padding:20px;font-size:13px;
background:#020617;opacity:.8;
}
</style>
</head>

<body>

<header>
<h1>CupX Corporation</h1>
<a href="https://cupx.in" class="home-btn">‚Üê Back to Home</a>
</header>

<main>
<div class="container">

<div class="search-wrapper">
<input type="text" id="searchBox" placeholder="Search by title..." onkeypress="if(event.key==='Enter') searchBook()">
<div class="search-icon-btn" onclick="searchBook()">üîç</div>
</div>

<div class="button-row">
<button onclick="exportExcel()">Export Excel</button>
<button onclick="exportPDF()">Export PDF</button>
</div>

<div id="notification" class="notification"></div>
<div id="results"></div>

</div>
</main>

<footer>¬© 2026 CupX Corporation ¬∑ All rights reserved</footer>

<script>
let currentResults=[];

async function searchBook(){
const query=document.getElementById("searchBox").value.trim().toLowerCase();
const notification=document.getElementById("notification");
const resultsDiv=document.getElementById("results");

notification.style.display="block";
notification.className="notification success";
notification.innerText="Searching...";
resultsDiv.innerHTML="";

if(!query){
notification.className="notification error";
notification.innerText="Please enter a search term.";
return;
}

const response=await fetch("https://library-back1.onrender.com/books");
const books=await response.json();

currentResults=books.filter(book=>book.title.toLowerCase().includes(query));

if(currentResults.length===0){
notification.className="notification error";
notification.innerText="No books found.";
return;
}

notification.innerText=currentResults.length+" result(s) found.";

resultsDiv.innerHTML=currentResults.map(book=>`
<div class="book-card">
<div><strong>${book.title}</strong></div>
<div>Language: ${book.language||"-"}</div>
<div>Material: ${book.material||"-"}</div>
</div>`).join("");
}

/* ------------------ EXCEL ------------------ */
function exportExcel(){
if(currentResults.length===0)return alert("No data to export.");

const wb=XLSX.utils.book_new();

const data=[
["KMCLU Library Search Portal by CupX"],
["Sr. No","Title","Language","Material"]
];

currentResults.forEach((b,i)=>{
data.push([i+1,b.title||"",b.language||"",b.material||""]);
});

const ws=XLSX.utils.aoa_to_sheet(data);

// Merge A1:D1
ws["!merges"]=[{s:{r:0,c:0},e:{r:0,c:3}}];

// Column width
ws["!cols"]=[{wch:8},{wch:45},{wch:15},{wch:22}];

// Increase row height
ws["!rows"]=[{hpt:40}];

XLSX.utils.book_append_sheet(wb,ws,"Library Data");

const wbout=XLSX.write(wb,{bookType:"xlsx",type:"array"});
const blob=new Blob([wbout],{type:"application/octet-stream"});
const link=document.createElement("a");
link.href=URL.createObjectURL(blob);
link.download="cupx-kmclulib.xlsx";
link.click();
}

/* ------------------ PDF ------------------ */
function exportPDF(){
if(currentResults.length===0)return alert("No data to export.");

const {jsPDF}=window.jspdf;
const doc=new jsPDF("p","mm","a4");

const rows=currentResults.map((b,i)=>[
i+1,b.title||"",b.language||"",b.material||""
]);

doc.autoTable({
head:[["Sr. No","Title","Language","Material"]],
body:rows,
margin:{top:35},
styles:{fontSize:9},
headStyles:{fillColor:[48,84,150],textColor:255},

didDrawPage:function(data){
doc.setFontSize(20);
doc.setFont(undefined,"bold");
doc.text("KMCLU Library Search Portal by CupX",105,20,{align:"center"});
doc.setFont(undefined,"normal");
}
});

doc.save("cupx-kmclulib.pdf");
}
</script>

</body>
</html>
